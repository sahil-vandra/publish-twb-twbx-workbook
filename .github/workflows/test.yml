name: CI
# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  pull_request:
    branches: [ "main" ]
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:  
  changedFilesList: 
    runs-on: ubuntu-latest
    outputs:
      changedfiles: ${{ steps.set-changed-files.outputs.changedfiles }} # generate output names changedfiles by using inner step output
    steps:
      - name: Clone Repo
        uses: actions/checkout@v2
      - name: Get main branch
        run: git fetch --no-tags --prune --depth=1 origin +refs/heads/${{ github.event.pull_request.base.ref }}:refs/remotes/origin/${{ github.event.pull_request.base.ref }}
      - name: Get list of changed files
        id: set-changed-files
        run: echo ::set-output name=changedfiles::$(git diff --name-only --diff-filter=AM origin/${{ github.event.pull_request.base.ref }} HEAD | jq -R -s -c 'split("\n")[:-1]' | jq -r '.[] | ("./" + .)')
      - name: Print files to be validated
        run: |
          echo "${{steps.set-changed-files.outputs.changedfiles}}"
  teblue: # Job that validates files and directory names
    runs-on: ubuntu-latest
    needs: changedFilesList
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Run Validation
        env:
          CHANGED_FILES: ${{ needs.changedFilesList.outputs.changedfiles }}
        run: |
          echo ${{ needs.changedFilesList.outputs.changedfiles }}
          echo "This is changedFilesList:::" $CHANGED_FILES